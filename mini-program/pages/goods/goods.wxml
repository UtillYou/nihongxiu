<view  wx:if="{{is_use == 1}}">
<import src="../template/login.wxml" />
<view class="container">
  <swiper class="goodsimgs" indicator-dots="true" autoplay="true" interval="3000" duration="1000">
    <swiper-item wx:for="{{gallery}}" wx:key="{{item.id}}">
      <image src="{{item}}" background-size="cover"></image>
    </swiper-item>
  </swiper>
  <view class="section-nav section-act" wx:if="{{is_special==true}}">
    <view class="t">
      <view class="tag">限时购</view>
      <view class="label">￥{{goods.price_info.special_price?goods.price_info.special_price.value:goods.price_info.price.value}}</view>
      <view class="text">{{discount}}折</view>
      <!-- <view class="text">剩余{{goods.qty}}个</view> -->
    </view>
    <view class="r">
      <view class="top">距离结束还有</view>
      <view class="bottom">
        <view class="syTime_time">{{wxTimerList['wxTimer3'].wxTimerHour}}</view>
        <view>:</view>
        <view class="syTime_time">{{wxTimerList['wxTimer3'].wxTimerMinute}}</view>
        <view>:</view>
        <view class="syTime_time">{{wxTimerList['wxTimer3'].wxTimerSecond}}</view>
      </view>
    </view>
  </view>
   <view class="section-t">
        <view class="goods-share" style="font-size:45rpx">￥{{goods.price_info.special_price.value!==null && goods.price_info.special_price.value>0?goods.price_info.special_price.value:goods.price_info.price.value}}</view>
        <view class="goods-title">{{goods.name}}</view>
        <view class="label-item-box">
            <!-- <view class="label-item" >
              包税
            </view> -->
            <view class="label-item" wx:for="{{goods.tags}}" wx:key="tags">
              {{item}}
            </view>
        </view>
        <view class="goods-share" wx:if="{{goods.tax > 0}}">进口税预计￥{{goods.tax}}</view>
        <view class="goods-share" wx:else>免税</view>
        <view class="goods-stitle" >{{goods.meta_title}}</view>
        <view class="goods-info-fx">
          <image src='{{collectBackImage}}' bindtap='addCannelCollect' />
          <text>收  藏</text>
        </view>
   </view>

  <!-- <view class="service-policy">
    <view class="item">30天无忧退货</view>
    <view class="item">48小时快速退款</view>
    <view class="item">满xx元免邮费</view>
  </view> -->
  <!-- <view class="goods-info"> -->
    <!-- <view class="c"> -->
      <!-- <text class="name" decode="{{true}}"> &nbsp; &nbsp;&nbsp; &nbsp;{{goods.meta_description}}</text> -->
      <!-- <text class="desc">{{goods.goods_brief}}默认描述字段</text> -->
      <!-- <text class="price">￥{{goods.price_info.special_price?goods.price_info.special_price.value:goods.price_info.price.value}}</text> -->
      <!-- <view class="brand" wx:if="{{brand.name}}">
        <navigator url="../brandDetail/brandDetail?id={{brand.brandId}}">
          <text>{{brand.name}}</text>
        </navigator>
      </view> -->
    <!-- </view> -->
  <!-- </view> -->
  <!-- <view class="section-nav section-attr" bindtap="switchAttrPop">
    <view class="t">请选择规格数量</view>
    <image class="i" src="../../static/images/address_right.png" background-size="cover"></image>
  </view> -->

  <wxs module="m1">
    function format(ts) {
      ts = ts * 1000;
      var d = getDate(ts)
      return [d.getFullYear(), d.getMonth() + 1, d.getDate()].join('-') +
        ' ' + [d.getHours(), d.getMinutes(), d.getSeconds()].join(':')
    }
    module.exports.format = format
  </wxs>

  <view class="comments" wx:if="{{comment.count != 0}}">
    <view class="h">
      <navigator url="../comment/comment?valueId={{goods._id}}&typeId=0">
        <text class="t">评价({{comment.count > 999 ? '999+' : comment.count}})</text>
        <text class="i">查看全部</text>
      </navigator>
    </view>
    <view class="b" wx:for="{{comment.coll}}"  wx:key="comment">
      <view class="item">
        <view class="info">
          <view class="user">
            <image src="{{item.avatar}}"></image>
            <text>{{item.name}} </text>
            <block wx:for="{{[1,2,3,4,5]}}" wx:for-item="item1" wx:if="{{item1<=item.rate_star}}">
              <image class="user_star" src="/static/images/wjx.png"></image>
            </block>
          </view>
          <view class="time">{{m1.format(item.review_date)}}</view>
        </view>
        <view class="content">
          {{item.review_content}}
        </view>
        <view class="imgs" wx:if="{{item.images.length > 0}}">
          <image class="img" wx:for="{{item.images}}" wx:key="{{item.id}}" src="{{item.imgsrc}}"></image>
        </view>
        <!-- <view class="spec">白色 2件</view> -->
      </view>
    </view>

  </view>
  <view class="goods-attr" wx:if="{{attribute.length>0}}">
    <view class="t">商品参数</view>
    <view class="l">
      <view class="item" wx:for="{{attribute}}" wx:key="{{item.name}}">
        <text class="left">{{item.name}}</text>
        <text class="right">{{item.value}}</text>
      </view>
    </view>
  </view>
  <view class="goods-attr">
    <view class="t">商品详情</view>
    <import src="../../lib/wxParse/wxParse.wxml" />
    <template is="wxParse" data="{{wxParseData:goodsDetail.nodes}}" />
  </view>
  <!-- <view class="detail">
    <import src="../../lib/wxParse/wxParse.wxml" />
    <template is="wxParse" data="{{wxParseData:goodsDetail.nodes}}" />
  </view> -->


  <!-- <view class="common-problem">
    <view class="h">
      <view class="line"></view>
      <text class="title">常见问题</text>
    </view>
    <view class="b">
      <view class="item" wx:for="{{issueList}}" wx:key="{{item.id}}">
        <view class="question-box">
          <text class="spot"></text>
          <text class="question">{{item.question}}</text>
        </view>
        <view class="answer">
          {{item.answer}}
        </view>
      </view>
    </view>
  </view> -->

  <view class="related-goods" wx:if="{{relatedGoods.length > 0}}">
    <view class="h">
      <view class="line"></view>
      <text class="title">大家都在看</text>
    </view>
    <view class="b">
      <view class="item" wx:for="{{relatedGoods}}" wx:key="{{item.product_id}}">
        <navigator url="/pages/goods/goods?id={{item.product_id}}">
          <image class="img" src="{{item.image}}" background-size="cover"></image>
          <text class="name">{{item.name}}</text>
          <text class="price">￥{{goods.price_info.special_price?goods.price_info.special_price.value:goods.price_info.price.value}}</text>
        </navigator>
      </view>
    </view>
  </view>
</view>
<view class="attr-pop-box" hidden="{{!openAttr}}">
  <view class="attr-pop">
    <view class="close" bindtap="closeAttr">
      <image class="icon" src="/static/images/icon_close.png"></image>
    </view>
    <view class="img-info">
      <image class="img" src="{{checkedGoods.checkedImg}}"></image>
      <view class="info">
        <view class="c">
          <view class="p">价格：<text style="color:red;">￥{{checkedGoods.checkedPrice}}</text></view>
          <!-- <view class="a" wx:if="{{productList.length>0}}">已选择：{{checkedSpecText}}</view> -->
        </view>
      </view>
    </view>
    <view class="spec-con">

      <!-- <view class="title">属性值联动选择start</view>   -->
      <!--options-->
      <view class="commodity_attr_list">
        <!--每组属性-->
        <view class="attr_box" wx:for="{{attrValueList}}" wx:for-item="attrValueObj" wx:for-index="attrIndex" wx:key="attrValueList">
          <!--属性名-->
          <view class="attr_name">{{attrValueObj.attrLabel}}</view>

          <!--属性值-->
          <view class="attr_value_box">
            <!--每个属性值-->
            <view class="attr_value {{attrIndex==firstIndex || attrValueObj.attrValueStatus[valueIndex]?(value==attrValueObj.selectedValue?'attr_value_active':''):'attr_value_disabled'}}" bindtap="selectAttrValue" data-status="{{attrValueObj.attrValueStatus[valueIndex]}}"
              data-value="{{value}}" data-key="{{attrValueObj.attrKey}}"  data-index="{{attrIndex}}" data-selectedvalue="{{attrValueObj.selectedValue}}" wx:for="{{attrValueObj.attrValues}}" wx:for-item="value" wx:for-index="valueIndex" data-code="{{attrValueObj.attrCode[valueIndex]}}">{{value}}</view>
          </view>
        </view>
      </view>

      <view class="number-item">
        <view class="name">数量</view>
        <view class="selnum">
          <view class="cut" bindtap="cutNumber">-</view>
          <input value="{{number}}" class="number" disabled="true" type="number" />
          <view class="add" bindtap="addNumber">+</view>
        </view>
      </view>
    </view>
  </view>
</view>
<view class="bottom-btn">
  <view class="l l-collect" >
    <view class="contact">
    <contact-button style="opacity:0;position:absolute;" type="default-dark" session-from="weapp" size="27"></contact-button>
    <view style='position:absolute;bottom:10rpx;font-size:20rpx;'> 客服 </view>
  </view>
  </view>
  <view class="l l-cart">
    <view class="box">
      <text class="cart-count">{{cartGoodsCount}}</text>
      <image bindtap="openCartPage" class="icon" src="/static/images/ic_menu_shoping_nor.png"></image>
      
    </view>
  </view>
  <view wx:if="{{!is_only_buynow}}" class='o'>
    <view class="r" bindtap="addToCart" wx:if="{{!is_only_buynow}}">
      <view class="add-cart">加入购物车</view>
    </view>
    <view class="c" bindtap='buyItNow'>
      <view class="buy-now">立即购买</view>
    </view>
  </view>
  <view  class='o' wx:else>
     <view class="c" bindtap='toBuyItNow' style='width:100%'>立即购买</view>
  </view>
</view>
<template is="login_tpl" data="{{showLoginDialog:showLoginDialog}}" />

</view>
<view wx:else>
    <view class="good_c">
      <image src="http://xwjxcximg.dongluting.com/assets/no_goods.png" />
      <text>商品不存在或已经下架</text>
    </view>
</view>